{% extends 'app.html' %}
{% load inscricoes_extras %}
{% load static %}

{% block title %}- Estatísticas{% endblock title %}

{% block load %}
    <link rel="stylesheet" href="{% static 'css/Chart.min.css' %}">
{% endblock load %}

{% block scripts %}
    <script src="{% static 'js/Chart.min.js' %}"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chartjs-plugin-datalabels/2.2.0/chartjs-plugin-datalabels.min.js"
            integrity="sha512-JPcRR8yFa8mmCsfrw4TNte1ZvF1e3+1SdGMslZvmrzDYxS69J7J49vkFL8u6u8PlPJK+H3voElBtUCzaXj+6ig=="
            crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script
            src="https://rawgit.com/chartjs/chartjs.github.io/master/dist/master/Chart.min.js"
    ></script>
    <script
            src="https://cdn.jsdelivr.net/npm/chartjs-plugin-piechart-outlabels"
    ></script>
    <script>

        function selectDiaAberto(selectObject) {
            const value = selectObject.value;
            location.href = "{% url 'questionarios:estatisticasAtividadeRoteiro' 12345 %}".replace(/12345/, value);
        }

        const resposta1GostasteDiaAberto = {{ respostas|respostaGostasteRoteiroComValor:"1" }};
        const resposta2GostasteDiaAberto = {{ respostas|respostaGostasteRoteiroComValor:"2" }};
        const resposta3GostasteDiaAberto = {{ respostas|respostaGostasteRoteiroComValor:"3" }};
        const resposta4GostasteDiaAberto = {{ respostas|respostaGostasteRoteiroComValor:"4" }};
        const resposta5GostasteDiaAberto = {{ respostas|respostaGostasteRoteiroComValor:"5" }};
        const ctx_respostasGostasteDiaAbertoGrafico = document.getElementById('respostasGostasteDiaAbertoGrafico').getContext('2d');
        const chart_respostasGostasteDiaAbertoGrafico = new Chart(ctx_respostasGostasteDiaAbertoGrafico, {
            type: 'pie',
            data: {
                labels: ["opção 1", "opção 2", "opção 3", "opção 4", "opção 5"],
                datasets: [{
                    backgroundColor: [
                        "rgb(196,1,1)",
                        "rgb(197,81,0)",
                        "rgb(206,169,2)",
                        "rgb(126,169,0)",
                        "rgba(9,134,0,0.6)",
                    ],
                    data: [
                        resposta1GostasteDiaAberto,
                        resposta2GostasteDiaAberto,
                        resposta3GostasteDiaAberto,
                        resposta4GostasteDiaAberto,
                        resposta5GostasteDiaAberto,
                    ],
                }]
            },
            options: {
                legend: {
                    position: 'left',
                    onClick: function (e, legendItem, legend) {

                    }
                },
                plugins: {
                    outlabels: {
                        text: '%p',
                        color: 'white',
                        stretch: 20,
                        font: {
                            resizable: false,
                            minSize: 90,
                            maxSize: 90,
                        },
                    },
                },
                tooltips: {enabled: false},
                hover: {mode: null},
                layout: {
                    padding: {
                        left: 30,
                        right: 30,
                        top: 30,
                        bottom: 30
                    }
                },
            },
        });

        const resposta1GostasteFuncionario = {{ respostas|respostaGostasteFuncionariosComValor:"1" }};
        const resposta2GostasteFuncionario = {{ respostas|respostaGostasteFuncionariosComValor:"2" }};
        const resposta3GostasteFuncionario = {{ respostas|respostaGostasteFuncionariosComValor:"3" }};
        const resposta4GostasteFuncionario = {{ respostas|respostaGostasteFuncionariosComValor:"4" }};
        const resposta5GostasteFuncionario = {{ respostas|respostaGostasteFuncionariosComValor:"5" }};
        const ctx_respostasGostasteFuncionarioGrafico = document.getElementById('respostasGostasteFuncionarioGrafico').getContext('2d');
        const chart_respostasGostasteFuncionarioGrafico = new Chart(ctx_respostasGostasteFuncionarioGrafico, {
            type: 'pie',
            data: {
                labels: ["opção 1", "opção 2", "opção 3", "opção 4", "opção 5"],
                datasets: [{
                    backgroundColor: [
                        "rgb(196,1,1)",
                        "rgb(197,81,0)",
                        "rgb(206,169,2)",
                        "rgb(126,169,0)",
                        "rgba(9,134,0,0.6)",
                    ],
                    data: [
                        resposta1GostasteFuncionario,
                        resposta2GostasteFuncionario,
                        resposta3GostasteFuncionario,
                        resposta4GostasteFuncionario,
                        resposta5GostasteFuncionario,
                    ],
                }]
            },
            options: {
                legend: {
                    position: 'left',
                    onClick: function (e, legendItem, legend) {

                    }
                },
                plugins: {
                    outlabels: {
                        text: '%p',
                        color: 'white',
                        stretch: 20,
                        font: {
                            resizable: false,
                            minSize: 90,
                            maxSize: 90,
                        },
                    },
                },
                tooltips: {enabled: false},
                hover: {mode: null},
                layout: {
                    padding: {
                        left: 30,
                        right: 30,
                        top: 30,
                        bottom: 30
                    }
                },
            },
        });


        const resposta1GostasteAtividade = {{ respostas|respostaGostasteComValor:"1" }};
        const resposta2GostasteAtividade = {{ respostas|respostaGostasteComValor:"2" }};
        const resposta3GostasteAtividade = {{ respostas|respostaGostasteComValor:"3" }};
        const resposta4GostasteAtividade = {{ respostas|respostaGostasteComValor:"4" }};
        const resposta5GostasteAtividade = {{ respostas|respostaGostasteComValor:"5" }};
        const ctx_respostasGostasteAtividadeGrafico = document.getElementById('respostasGostasteAtividadeGrafico').getContext('2d');
        const chart_respostasGostasteAtividadeGrafico = new Chart(ctx_respostasGostasteAtividadeGrafico, {
            type: 'pie',
            data: {
                labels: ["opção 1", "opção 2", "opção 3", "opção 4", "opção 5"],
                datasets: [{
                    backgroundColor: [
                        "rgb(196,1,1)",
                        "rgb(197,81,0)",
                        "rgb(206,169,2)",
                        "rgb(126,169,0)",
                        "rgba(9,134,0,0.6)",
                    ],
                    data: [
                        resposta1GostasteAtividade,
                        resposta2GostasteAtividade,
                        resposta3GostasteAtividade,
                        resposta4GostasteAtividade,
                        resposta5GostasteAtividade,
                    ],
                }]
            },
            options: {
                legend: {
                    position: 'left',
                    onClick: function (e, legendItem, legend) {

                    }
                },
                plugins: {
                    outlabels: {
                        text: '%p',
                        color: 'white',
                        stretch: 20,
                        font: {
                            resizable: false,
                            minSize: 90,
                            maxSize: 90,
                        },
                    },
                },
                tooltips: {enabled: false},
                hover: {mode: null},
                layout: {
                    padding: {
                        left: 30,
                        right: 30,
                        top: 30,
                        bottom: 30
                    }
                },
            },
        });


        const resposta1Conhecimento = {{ respostas|respostaRetencaoComValor:"1" }};
        const resposta2Conhecimento = {{ respostas|respostaRetencaoComValor:"2" }};
        const resposta3Conhecimento = {{ respostas|respostaRetencaoComValor:"3" }};
        const resposta4Conhecimento = {{ respostas|respostaRetencaoComValor:"4" }};
        const resposta5Conhecimento = {{ respostas|respostaRetencaoComValor:"5" }};
        const ctx_respostasConhecimentoAtividadeGrafico = document.getElementById('respostasConhecimentoAtividadeGrafico').getContext('2d');
        const chart_respostasConhecimentoAtividadeGrafico = new Chart(ctx_respostasConhecimentoAtividadeGrafico, {
            type: 'pie',
            data: {
                labels: ["opção 1", "opção 2", "opção 3", "opção 4", "opção 5"],
                datasets: [{
                    backgroundColor: [
                        "rgb(196,1,1)",
                        "rgb(197,81,0)",
                        "rgb(206,169,2)",
                        "rgb(126,169,0)",
                        "rgba(9,134,0,0.6)",
                    ],
                    data: [
                        resposta1Conhecimento,
                        resposta2Conhecimento,
                        resposta3Conhecimento,
                        resposta4Conhecimento,
                        resposta5Conhecimento,
                    ],
                }]
            },
            options: {
                legend: {
                    position: 'left',
                    onClick: function (e, legendItem, legend) {

                    }
                },
                plugins: {
                    outlabels: {
                        text: '%p',
                        color: 'white',
                        stretch: 20,
                        font: {
                            resizable: false,
                            minSize: 90,
                            maxSize: 90,
                        },
                    },
                },
                tooltips: {enabled: false},
                hover: {mode: null},
                layout: {
                    padding: {
                        left: 30,
                        right: 30,
                        top: 30,
                        bottom: 30
                    }
                },
            },
        });


        const resposta1Responsavel = {{ respostas|respostaResponsavelComValor:"1" }};
        const resposta2Responsavel = {{ respostas|respostaResponsavelComValor:"2" }};
        const resposta3Responsavel = {{ respostas|respostaResponsavelComValor:"3" }};
        const resposta4Responsavel = {{ respostas|respostaResponsavelComValor:"4" }};
        const resposta5Responsavel = {{ respostas|respostaResponsavelComValor:"5" }};
        const ctx_respostasResponsavelAtividadeGrafico = document.getElementById('respostasResponsavelAtividadeGrafico').getContext('2d');
        const chart_respostasResponsavelAtividadeGrafico = new Chart(ctx_respostasResponsavelAtividadeGrafico, {
            type: 'pie',
            data: {
                labels: ["opção 1", "opção 2", "opção 3", "opção 4", "opção 5"],
                datasets: [{
                    backgroundColor: [
                        "rgb(196,1,1)",
                        "rgb(197,81,0)",
                        "rgb(206,169,2)",
                        "rgb(126,169,0)",
                        "rgba(9,134,0,0.6)",
                    ],
                    data: [
                        resposta1Responsavel,
                        resposta2Responsavel,
                        resposta3Responsavel,
                        resposta4Responsavel,
                        resposta5Responsavel,
                    ],
                }]
            },
            options: {
                legend: {
                    position: 'left',
                    onClick: function (e, legendItem, legend) {

                    }
                },
                plugins: {
                    outlabels: {
                        text: '%p',
                        color: 'white',
                        stretch: 20,
                        font: {
                            resizable: false,
                            minSize: 90,
                            maxSize: 90,
                        },
                    },
                },
                tooltips: {enabled: false},
                hover: {mode: null},
                layout: {
                    padding: {
                        left: 30,
                        right: 30,
                        top: 30,
                        bottom: 30
                    }
                },
            },
        });


        const resposta1Recomendacao = {{ respostas|respostaRecomendacaoComValor:"1" }};
        const resposta2Recomendacao = {{ respostas|respostaRecomendacaoComValor:"2" }};
        const resposta3Recomendacao = {{ respostas|respostaRecomendacaoComValor:"3" }};
        const resposta4Recomendacao = {{ respostas|respostaRecomendacaoComValor:"4" }};
        const resposta5Recomendacao = {{ respostas|respostaRecomendacaoComValor:"5" }};
        const ctx_respostasRecomendacaoAtividadeGrafico = document.getElementById('respostasRecomendacaoAtividadeGrafico').getContext('2d');
        const chart_respostasRecomendacaoAtividadeGrafico = new Chart(ctx_respostasRecomendacaoAtividadeGrafico, {
            type: 'pie',
            data: {
                labels: ["opção 1", "opção 2", "opção 3", "opção 4", "opção 5"],
                datasets: [{
                    backgroundColor: [
                        "rgb(196,1,1)",
                        "rgb(197,81,0)",
                        "rgb(206,169,2)",
                        "rgb(126,169,0)",
                        "rgba(9,134,0,0.6)",
                    ],
                    data: [
                        resposta1Recomendacao,
                        resposta2Recomendacao,
                        resposta3Recomendacao,
                        resposta4Recomendacao,
                        resposta5Recomendacao,
                    ],
                }]
            },
            options: {
                legend: {
                    position: 'left',
                    onClick: function (e, legendItem, legend) {

                    }
                },
                plugins: {
                    outlabels: {
                        text: '%p',
                        color: 'white',
                        stretch: 20,
                        font: {
                            resizable: false,
                            minSize: 90,
                            maxSize: 90,
                        },
                    },
                },
                tooltips: {enabled: false},
                hover: {mode: null},
                layout: {
                    padding: {
                        left: 30,
                        right: 30,
                        top: 30,
                        bottom: 30
                    }
                },
            },
        });


        const resposta1Expectativa = {{ respostas|respostaExpectativaComValor:"1" }};
        const resposta2Expectativa = {{ respostas|respostaExpectativaComValor:"2" }};
        const resposta3Expectativa = {{ respostas|respostaExpectativaComValor:"3" }};
        const resposta4Expectativa = {{ respostas|respostaExpectativaComValor:"4" }};
        const resposta5Expectativa = {{ respostas|respostaExpectativaComValor:"5" }};
        const ctx_respostasExpectativaAtividadeGrafico = document.getElementById('respostasExpectativaAtividadeGrafico').getContext('2d');
        const chart_respostasExpectativaAtividadeGrafico = new Chart(ctx_respostasExpectativaAtividadeGrafico, {
            type: 'pie',
            data: {
                labels: ["opção 1", "opção 2", "opção 3", "opção 4", "opção 5"],
                datasets: [{
                    backgroundColor: [
                        "rgb(196,1,1)",
                        "rgb(197,81,0)",
                        "rgb(206,169,2)",
                        "rgb(126,169,0)",
                        "rgba(9,134,0,0.6)",
                    ],
                    data: [
                        resposta1Expectativa,
                        resposta2Expectativa,
                        resposta3Expectativa,
                        resposta4Expectativa,
                        resposta5Expectativa,
                    ],
                }]
            },
            options: {
                legend: {
                    position: 'left',
                    onClick: function (e, legendItem, legend) {

                    }
                },
                plugins: {
                    outlabels: {
                        text: '%p',
                        color: 'white',
                        stretch: 20,
                        font: {
                            resizable: false,
                            minSize: 90,
                            maxSize: 90,
                        },
                    },
                },
                tooltips: {enabled: false},
                hover: {mode: null},
                layout: {
                    padding: {
                        left: 30,
                        right: 30,
                        top: 30,
                        bottom: 30
                    }
                },
            },
        });

        function updateGraphs(data, check) {
            function countResponsesWithValue(respostas, value, pergunta) {
                // Filter the responses array based on the value and pergunta
                const respostasWithValue = respostas.filter(function (resposta) {
                    return resposta.resposta === value.toString() && resposta.perguntaID_id === pergunta;
                });
                // Return the length of the filtered array
                return respostasWithValue.length;
            }

            if (check) {
                const resposta1GostasteDiaAberto = countResponsesWithValue(data.respostas, 1, 6);
                const resposta2GostasteDiaAberto = countResponsesWithValue(data.respostas, 2, 6);
                const resposta3GostasteDiaAberto = countResponsesWithValue(data.respostas, 3, 6);
                const resposta4GostasteDiaAberto = countResponsesWithValue(data.respostas, 4, 6);
                const resposta5GostasteDiaAberto = countResponsesWithValue(data.respostas, 5, 6);
                const ctx_respostasGostasteDiaAbertoGrafico = document.getElementById('respostasGostasteDiaAbertoGrafico').getContext('2d');
                const chart_respostasGostasteDiaAbertoGrafico = new Chart(ctx_respostasGostasteDiaAbertoGrafico, {
                    type: 'pie',
                    data: {
                        labels: ["opção 1", "opção 2", "opção 3", "opção 4", "opção 5"],
                        datasets: [{
                            backgroundColor: [
                                "rgb(196,1,1)",
                                "rgb(197,81,0)",
                                "rgb(206,169,2)",
                                "rgb(126,169,0)",
                                "rgba(9,134,0,0.6)",
                            ],
                            data: [
                                resposta1GostasteDiaAberto,
                                resposta2GostasteDiaAberto,
                                resposta3GostasteDiaAberto,
                                resposta4GostasteDiaAberto,
                                resposta5GostasteDiaAberto,
                            ],
                        }]
                    },
                    options: {
                        legend: {
                            position: 'left',
                            onClick: function (e, legendItem, legend) {

                            }
                        },
                        plugins: {
                            outlabels: {
                                text: '%p',
                                color: 'white',
                                stretch: 20,
                                font: {
                                    resizable: false,
                                    minSize: 90,
                                    maxSize: 90,
                                },
                            },
                        },
                        tooltips: {enabled: false},
                        hover: {mode: null},
                        layout: {
                            padding: {
                                left: 30,
                                right: 30,
                                top: 30,
                                bottom: 30
                            }
                        },
                    },
                });

                const resposta1GostasteFuncionario = countResponsesWithValue(data.respostas, 1, 7);
                const resposta2GostasteFuncionario = countResponsesWithValue(data.respostas, 2, 7);
                const resposta3GostasteFuncionario = countResponsesWithValue(data.respostas, 3, 7);
                const resposta4GostasteFuncionario = countResponsesWithValue(data.respostas, 4, 7);
                const resposta5GostasteFuncionario = countResponsesWithValue(data.respostas, 5, 7);
                const ctx_respostasGostasteFuncionarioGrafico = document.getElementById('respostasGostasteFuncionarioGrafico').getContext('2d');
                const chart_respostasGostasteFuncionarioGrafico = new Chart(ctx_respostasGostasteFuncionarioGrafico, {
                    type: 'pie',
                    data: {
                        labels: ["opção 1", "opção 2", "opção 3", "opção 4", "opção 5"],
                        datasets: [{
                            backgroundColor: [
                                "rgb(196,1,1)",
                                "rgb(197,81,0)",
                                "rgb(206,169,2)",
                                "rgb(126,169,0)",
                                "rgba(9,134,0,0.6)",
                            ],
                            data: [
                                resposta1GostasteFuncionario,
                                resposta2GostasteFuncionario,
                                resposta3GostasteFuncionario,
                                resposta4GostasteFuncionario,
                                resposta5GostasteFuncionario,
                            ],
                        }]
                    },
                    options: {
                        legend: {
                            position: 'left',
                            onClick: function (e, legendItem, legend) {

                            }
                        },
                        plugins: {
                            outlabels: {
                                text: '%p',
                                color: 'white',
                                stretch: 20,
                                font: {
                                    resizable: false,
                                    minSize: 90,
                                    maxSize: 90,
                                },
                            },
                        },
                        tooltips: {enabled: false},
                        hover: {mode: null},
                        layout: {
                            padding: {
                                left: 30,
                                right: 30,
                                top: 30,
                                bottom: 30
                            }
                        },
                    },
                });
            }


            const resposta1GostasteAtividade = countResponsesWithValue(data.respostas, 1, 1);
            const resposta2GostasteAtividade = countResponsesWithValue(data.respostas, 2, 1);
            const resposta3GostasteAtividade = countResponsesWithValue(data.respostas, 3, 1);
            const resposta4GostasteAtividade = countResponsesWithValue(data.respostas, 4, 1);
            const resposta5GostasteAtividade = countResponsesWithValue(data.respostas, 5, 1);
            const ctx_respostasGostasteAtividadeGrafico = document.getElementById('respostasGostasteAtividadeGrafico').getContext('2d');
            const chart_respostasGostasteAtividadeGrafico = new Chart(ctx_respostasGostasteAtividadeGrafico, {
                type: 'pie',
                data: {
                    labels: ["opção 1", "opção 2", "opção 3", "opção 4", "opção 5"],
                    datasets: [{
                        backgroundColor: [
                            "rgb(196,1,1)",
                            "rgb(197,81,0)",
                            "rgb(206,169,2)",
                            "rgb(126,169,0)",
                            "rgba(9,134,0,0.6)",
                        ],
                        data: [
                            resposta1GostasteAtividade,
                            resposta2GostasteAtividade,
                            resposta3GostasteAtividade,
                            resposta4GostasteAtividade,
                            resposta5GostasteAtividade,
                        ],
                    }]
                },
                options: {
                    legend: {
                        position: 'left',
                        onClick: function (e, legendItem, legend) {

                        }
                    },
                    plugins: {
                        outlabels: {
                            text: '%p',
                            color: 'white',
                            stretch: 20,
                            font: {
                                resizable: false,
                                minSize: 90,
                                maxSize: 90,
                            },
                        },
                    },
                    tooltips: {enabled: false},
                    hover: {mode: null},
                    layout: {
                        padding: {
                            left: 30,
                            right: 30,
                            top: 30,
                            bottom: 30
                        }
                    },
                },
            });


            const resposta1Conhecimento = countResponsesWithValue(data.respostas, 1, 2);
            const resposta2Conhecimento = countResponsesWithValue(data.respostas, 2, 2);
            const resposta3Conhecimento = countResponsesWithValue(data.respostas, 3, 2);
            const resposta4Conhecimento = countResponsesWithValue(data.respostas, 4, 2);
            const resposta5Conhecimento = countResponsesWithValue(data.respostas, 5, 2);
            const ctx_respostasConhecimentoAtividadeGrafico = document.getElementById('respostasConhecimentoAtividadeGrafico').getContext('2d');
            const chart_respostasConhecimentoAtividadeGrafico = new Chart(ctx_respostasConhecimentoAtividadeGrafico, {
                type: 'pie',
                data: {
                    labels: ["opção 1", "opção 2", "opção 3", "opção 4", "opção 5"],
                    datasets: [{
                        backgroundColor: [
                            "rgb(196,1,1)",
                            "rgb(197,81,0)",
                            "rgb(206,169,2)",
                            "rgb(126,169,0)",
                            "rgba(9,134,0,0.6)",
                        ],
                        data: [
                            resposta1Conhecimento,
                            resposta2Conhecimento,
                            resposta3Conhecimento,
                            resposta4Conhecimento,
                            resposta5Conhecimento,
                        ],
                    }]
                },
                options: {
                    legend: {
                        position: 'left',
                        onClick: function (e, legendItem, legend) {

                        }
                    },
                    plugins: {
                        outlabels: {
                            text: '%p',
                            color: 'white',
                            stretch: 20,
                            font: {
                                resizable: false,
                                minSize: 90,
                                maxSize: 90,
                            },
                        },
                    },
                    tooltips: {enabled: false},
                    hover: {mode: null},
                    layout: {
                        padding: {
                            left: 30,
                            right: 30,
                            top: 30,
                            bottom: 30
                        }
                    },
                },
            });


            const resposta1Responsavel = countResponsesWithValue(data.respostas, 1, 3);
            const resposta2Responsavel = countResponsesWithValue(data.respostas, 2, 3);
            const resposta3Responsavel = countResponsesWithValue(data.respostas, 3, 3);
            const resposta4Responsavel = countResponsesWithValue(data.respostas, 4, 3);
            const resposta5Responsavel = countResponsesWithValue(data.respostas, 5, 3);
            const ctx_respostasResponsavelAtividadeGrafico = document.getElementById('respostasResponsavelAtividadeGrafico').getContext('2d');
            const chart_respostasResponsavelAtividadeGrafico = new Chart(ctx_respostasResponsavelAtividadeGrafico, {
                type: 'pie',
                data: {
                    labels: ["opção 1", "opção 2", "opção 3", "opção 4", "opção 5"],
                    datasets: [{
                        backgroundColor: [
                            "rgb(196,1,1)",
                            "rgb(197,81,0)",
                            "rgb(206,169,2)",
                            "rgb(126,169,0)",
                            "rgba(9,134,0,0.6)",
                        ],
                        data: [
                            resposta1Responsavel,
                            resposta2Responsavel,
                            resposta3Responsavel,
                            resposta4Responsavel,
                            resposta5Responsavel,
                        ],
                    }]
                },
                options: {
                    legend: {
                        position: 'left',
                        onClick: function (e, legendItem, legend) {

                        }
                    },
                    plugins: {
                        outlabels: {
                            text: '%p',
                            color: 'white',
                            stretch: 20,
                            font: {
                                resizable: false,
                                minSize: 90,
                                maxSize: 90,
                            },
                        },
                    },
                    tooltips: {enabled: false},
                    hover: {mode: null},
                    layout: {
                        padding: {
                            left: 30,
                            right: 30,
                            top: 30,
                            bottom: 30
                        }
                    },
                },
            });


            const resposta1Recomendacao = countResponsesWithValue(data.respostas, 1, 4);
            const resposta2Recomendacao = countResponsesWithValue(data.respostas, 2, 4);
            const resposta3Recomendacao = countResponsesWithValue(data.respostas, 3, 4);
            const resposta4Recomendacao = countResponsesWithValue(data.respostas, 4, 4);
            const resposta5Recomendacao = countResponsesWithValue(data.respostas, 5, 4);
            const ctx_respostasRecomendacaoAtividadeGrafico = document.getElementById('respostasRecomendacaoAtividadeGrafico').getContext('2d');
            const chart_respostasRecomendacaoAtividadeGrafico = new Chart(ctx_respostasRecomendacaoAtividadeGrafico, {
                type: 'pie',
                data: {
                    labels: ["opção 1", "opção 2", "opção 3", "opção 4", "opção 5"],
                    datasets: [{
                        backgroundColor: [
                            "rgb(196,1,1)",
                            "rgb(197,81,0)",
                            "rgb(206,169,2)",
                            "rgb(126,169,0)",
                            "rgba(9,134,0,0.6)",
                        ],
                        data: [
                            resposta1Recomendacao,
                            resposta2Recomendacao,
                            resposta3Recomendacao,
                            resposta4Recomendacao,
                            resposta5Recomendacao,
                        ],
                    }]
                },
                options: {
                    legend: {
                        position: 'left',
                        onClick: function (e, legendItem, legend) {

                        }
                    },
                    plugins: {
                        outlabels: {
                            text: '%p',
                            color: 'white',
                            stretch: 20,
                            font: {
                                resizable: false,
                                minSize: 90,
                                maxSize: 90,
                            },
                        },
                    },
                    tooltips: {enabled: false},
                    hover: {mode: null},
                    layout: {
                        padding: {
                            left: 30,
                            right: 30,
                            top: 30,
                            bottom: 30
                        }
                    },
                },
            });


            const resposta1Expectativa = countResponsesWithValue(data.respostas, 1, 5);
            const resposta2Expectativa = countResponsesWithValue(data.respostas, 2, 5);
            const resposta3Expectativa = countResponsesWithValue(data.respostas, 3, 5);
            const resposta4Expectativa = countResponsesWithValue(data.respostas, 4, 5);
            const resposta5Expectativa = countResponsesWithValue(data.respostas, 5, 5);
            const ctx_respostasExpectativaAtividadeGrafico = document.getElementById('respostasExpectativaAtividadeGrafico').getContext('2d');
            const chart_respostasExpectativaAtividadeGrafico = new Chart(ctx_respostasExpectativaAtividadeGrafico, {
                type: 'pie',
                data: {
                    labels: ["opção 1", "opção 2", "opção 3", "opção 4", "opção 5"],
                    datasets: [{
                        backgroundColor: [
                            "rgb(196,1,1)",
                            "rgb(197,81,0)",
                            "rgb(206,169,2)",
                            "rgb(126,169,0)",
                            "rgba(9,134,0,0.6)",
                        ],
                        data: [
                            resposta1Expectativa,
                            resposta2Expectativa,
                            resposta3Expectativa,
                            resposta4Expectativa,
                            resposta5Expectativa,
                        ],
                    }]
                },
                options: {
                    legend: {
                        position: 'left',
                        onClick: function (e, legendItem, legend) {

                        }
                    },
                    plugins: {
                        outlabels: {
                            text: '%p',
                            color: 'white',
                            stretch: 20,
                            font: {
                                resizable: false,
                                minSize: 90,
                                maxSize: 90,
                            },
                        },
                    },
                    tooltips: {enabled: false},
                    hover: {mode: null},
                    layout: {
                        padding: {
                            left: 30,
                            right: 30,
                            top: 30,
                            bottom: 30
                        }
                    },
                },
            });
        }


        const selectedValue = 0
        document.getElementById('roteiro-select').addEventListener('change', function () {
            const currentCounter = this.value;
            currentRoteiroValue = $('#atividade-select').val();
            console.log(currentRoteiroValue)
            console.log("func");
            $.ajax({
                url: "{% url 'questionarios:getRespostasAtividadeRoteiro' %}",
                type: "POST",
                headers: {'X-CSRFToken': '{{ csrf_token }}'},
                data: {
                    'roteiroID': currentCounter,
                    'temaID': -1,
                    'diaaberto': '{{ diaaberto.id }}'
                },
                dataType: "json",
                success: function (data) {
                    console.log(data.atividades)
                    console.log(data.respostas)
                    updateGraphs(data, true);
                    $('#atividade-select').empty();
                    $('#atividade-select').append('<option value="-1">Geral</option>');
                    data.atividades.forEach(function (atividade) {
                        $('#atividade-select').append('<option value="' + atividade.id + '">' + atividade.nome + '</option>');
                    });

                },
                error: function (error) {
                    console.log(error);
                }
            });
        });

        document.getElementById('atividade-select').addEventListener('change', function () {
            currentRoteiroValue = $('#roteiro-select').val();
            $.ajax({
                url: "{% url 'questionarios:getRespostasAtividadeRoteiro' %}",
                type: "POST",
                headers: {'X-CSRFToken': '{{ csrf_token }}'},
                data: {
                    'roteiroID': currentRoteiroValue,
                    'temaID': this.value,
                    'diaaberto': '{{ diaaberto.id }}'
                },
                dataType: "json",
                success: function (data) {
                    console.log(data.atividades)
                    console.log(data.respostas)
                    updateGraphs(data, false);

                },
                error: function (error) {
                    console.log(error);
                }
            });
        });

        async function exportarPDF() {
            currentRoteiroValue = $('#roteiro-select');
            var selectedOption = currentRoteiroValue.find('option:selected');
            var roteiroSelected = selectedOption.text();
            console.log(roteiroSelected);

            currentAtividadeValue = $('#atividade-select');
            var selectedOption1 = currentAtividadeValue.find('option:selected');
            var atividadeSelected = selectedOption1.text();
            console.log(atividadeSelected);

            // Criar uma instância de jsPDF em orientação retrato e tamanho A4
            const pdf = new jspdf.jsPDF();

            // Carregar uma imagem da pasta "img"
            {#const imageElement = document.createElement("img");#}
            const imageElement = new Image();
            imageElement.src = "/static/img/logo-navbar.png"; // Caminho para a imagem na pasta

            await new Promise((resolve) => {
                imageElement.onload = resolve;
            });

            // Obter o Data URL da imagem carregada
            const imageData = imageElement.src;

            // Alterar fonte e cor do texto
            pdf.setFont("Courier", "bolditalic"); // Escolher a família da fonte e o estilo (negrito e itálico)
            pdf.setFontSize(14); // Definir o tamanho da fonte
            pdf.setTextColor(128, 128, 128); // Definir a cor do texto (RGB), neste caso vermelho

            // Adicionar a imagem ao PDF
            let posX4 = 20;
            let posY4 = 5;
            const larguraGrafico4 = 155; // Largura em mm
            const alturaGrafico4 = 25; // Altura em mm

            pdf.addImage(imageData, 'PNG', posX4, posY4, larguraGrafico4, alturaGrafico4);

            // Adicionar texto entre a imagem e os gráficos
            const posXText = 55;
            const posYText = 40; // Ajuste a posição Y para que o texto fique entre a imagem e os gráficos
            pdf.text("Estatística sobre os Atividade/Roteiro", posXText, posYText);
            const pdfWidth2 = pdf.internal.pageSize.getWidth();
            pdf.setFontSize(10);
            var r = "Roteiro" + roteiroSelected;
            var a = "Atividade" + atividadeSelected;
            const textWidth = pdf.getStringUnitWidth(r) * pdf.internal.getFontSize() / pdf.internal.scaleFactor;
            const textWidth2 = pdf.getStringUnitWidth(a) * pdf.internal.getFontSize() / pdf.internal.scaleFactor;
            const centerX = (pdfWidth2 - textWidth) / 2;
            const centerX2 = (pdfWidth2 - textWidth2) / 2;
            pdf.text("Roteiro " + roteiroSelected, centerX, posYText + 10);
            const grafico1 = document.getElementById('respostasGostasteDiaAbertoGrafico').toDataURL();
            const grafico2 = document.getElementById('respostasGostasteFuncionarioGrafico').toDataURL();
            const grafico3 = document.getElementById('respostasGostasteAtividadeGrafico').toDataURL();
            const grafico4 = document.getElementById('respostasConhecimentoAtividadeGrafico').toDataURL();
            const grafico5 = document.getElementById('respostasResponsavelAtividadeGrafico').toDataURL();
            const grafico6 = document.getElementById('respostasRecomendacaoAtividadeGrafico').toDataURL();
            const grafico7 = document.getElementById('respostasExpectativaAtividadeGrafico').toDataURL();
            const pdfWidth = pdf.internal.pageSize.getWidth();
            const larguraGrafico = 100;
            const alturaGrafico = 50;
            let posY = 70;
            let posX = 10
            let posX2 = larguraGrafico + 10;
            pdf.setFontSize(8);
            pdf.text("Grau de satisfação em relação ao dia", posX + 25, posY - 5);
            pdf.addImage(grafico1, 'PNG', posX, posY, larguraGrafico, alturaGrafico);

            pdf.text("Grau de satisfação em relação aos", posX2 + 30, posY - 5);
            pdf.text("funcionários", posX2 + 52, posY);
            pdf.addImage(grafico3, 'PNG', posX2, posY, larguraGrafico, alturaGrafico);
            posY += alturaGrafico + 30; // Atualizar a posição y para o próximo gráfico, com espaçamento de 10 mm


            pdf.setFontSize(10);
            pdf.text("Atividade " + atividadeSelected, centerX2, posY - 20);
            pdf.setFontSize(8);
            pdf.text("Gau de aprovação dos alunos à atividade", posX + 25, posY - 5);
            pdf.addImage(grafico2, 'PNG', posX, posY, larguraGrafico, alturaGrafico);
            {#posY += alturaGrafico + 30; // Atualizar a posição y para o próximo gráfico, com espaçamento de 10 mm#}

            pdf.text("Grau de cumpriu as expectativas em relação", posX2 + 18, posY - 5);
            pdf.text("à atividade", posX2 + 45, posY);
            pdf.addImage(grafico4, 'PNG', posX2, posY, larguraGrafico, alturaGrafico);

            posY = 230;

            pdf.text("Grau de retenção de conhecimento", posX + 28, posY - 5);
            pdf.text("alunos à atividade", posX + 38, posY);
            pdf.addImage(grafico5, 'PNG', posX, posY, larguraGrafico, alturaGrafico);
            {#posY += alturaGrafico + 30; // Atualizar a posição y para o próximo gráfico, com espaçamento de 10 mm#}

            pdf.text("Grau de recomendação dos alunos", posX2 + 25, posY - 5);
            pdf.text("à atividade", posX2 + 45, posY);
            pdf.addImage(grafico6, 'PNG', posX2, posY, larguraGrafico, alturaGrafico);

            // Salvar o PDF
            pdf.addPage();
            posY = 30;
            posX = 10;
            pdf.text("Avaliação do responsável da atividade", posX + 30, posY - 5);
            pdf.addImage(grafico7, 'PNG', posX, posY, larguraGrafico, alturaGrafico);
            pdf.save('graficos.pdf');
        }

    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>

{% endblock scripts %}

{% block content %}
    <div>
        <nav aria-label="breadcrumbs" class="breadcrumb">
            <ul>
                <li><a href="{% url 'home' %}">Início</a></li>
                <li class="is-active"><a href="">Dados e Estatísticas</a></li>
            </ul>
        </nav>
        <div style="padding: 3rem 2vw 1rem;">
            <div class="field is-horizontal">
                <div class="field-label is-normal">
                    <label class="label">Dia Aberto</label>
                </div>
                <div class="field-body">
                    <div class="field">
                        <p class="control">
                        <div class="select">
                            <select value="{{ diaaberto.id }}" onchange="selectDiaAberto(this)">
                                {% for dia_aberto in diasabertos %}
                                    <option value="{{ dia_aberto.id }}"
                                            {% if diaaberto.id == dia_aberto.id %}selected{% endif %}>{{ dia_aberto }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        </p>
                    </div>
                </div>
            </div>
            <hr>
            <h2 class="title has-text-grey is-uppercase has-text-centered" style="font-size: 0.9rem">
                Roteiros Dia Aberto {{ diaaberto.ano }}
            </h2>
            <div class="field is-horizontal">
                <div class="field-label is-normal">
                    <label class="label">Roteiros</label>
                </div>
                <div class="field-body">
                    <div class="field">
                        <p class="control">
                        <div class="select">
                            <select id="roteiro-select">
                                <option value="-1" selected>Geral</option>
                                {% for roteiro in roteiros %}
                                    <option value="{{ roteiro.id }}">{{ roteiro.nome }}</option>
                                {% endfor %}
                            </select>
                            </p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="columns" style="margin-top:30px;">
                <div class="column">
                    <p class="title has-text-grey is-uppercase has-text-centered"
                       style="font-size: 0.9rem; margin-left:100px;margin-top:50px;">
                        Grau de satisfação em relação ao dia
                    </p>
                    <canvas id="respostasGostasteDiaAbertoGrafico"></canvas>
                </div>
                <div class="column">
                    <p class="title has-text-grey is-uppercase has-text-centered"
                       style="font-size: 0.9rem; margin-left:100px;margin-top:50px;">
                        Grau de satisfação em relação aoos funcionários
                    </p>
                    <canvas id="respostasGostasteFuncionarioGrafico"></canvas>
                </div>
            </div>

            <h2 class="title has-text-grey is-uppercase has-text-centered" style="font-size: 0.9rem"
                style="margin-top: 80px;">
                Atividades Dia Aberto {{ diaaberto.ano }}
            </h2>
            <div class="field is-horizontal" style="margin-top: 70px;">

                <div class="field-label is-normal">
                    <label class="label">Atividades</label>
                </div>
                <div class="field-body">
                    <div class="field">
                        <p class="control">
                        <div class="select">
                            <select id="atividade-select">
                                <option value="-1" selected>Geral</option>
                                {% for roteiro in atividades %}
                                    <option value="{{ roteiro.id }}">{{ roteiro.nome }}</option>
                                {% endfor %}
                            </select>
                            </p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="columns" style="margin-top:30px;">
                <div class="column">
                    <p class="title has-text-grey is-uppercase has-text-centered"
                       style="font-size: 0.9rem; margin-left:100px;margin-top:50px;">
                        Grau de aprovação dos alunos à atividade
                    </p>
                    <canvas id="respostasGostasteAtividadeGrafico"></canvas>
                    <p class="title has-text-grey is-uppercase has-text-centered"
                       style="font-size: 0.9rem; margin-left:100px;margin-top:50px;">
                        Grau de retenção de conhecimento dos alunos à atividade
                    </p>
                    <canvas id="respostasConhecimentoAtividadeGrafico"></canvas>
                    <p class="title has-text-grey is-uppercase has-text-centered"
                       style="font-size: 0.9rem; margin-left:100px;margin-top:50px;">
                        Avaliação do responsável da atividade
                    </p>
                    <canvas id="respostasExpectativaAtividadeGrafico"></canvas>
                </div>
                <div class="column">
                    <p class="title has-text-grey is-uppercase has-text-centered"
                       style="font-size: 0.9rem; margin-left:100px;margin-top:50px;">
                        Grau de cumpriu as expectativas em relação à atividade
                    </p>
                    <canvas id="respostasResponsavelAtividadeGrafico"></canvas>
                    <p class="title has-text-grey is-uppercase has-text-centered"
                       style="font-size: 0.9rem; margin-left:100px;margin-top:50px;">
                        Grau de recomendação dos alunos à atividade
                    </p>
                    <canvas id="respostasRecomendacaoAtividadeGrafico"></canvas>
                </div>
            </div>

            <div class="columns">
                <div class="column is-full">
                    <canvas id="duracao-roteiros"></canvas>
                </div>
            </div>
            <button type="button" id="obterPdfButton" class="button is-danger" onclick="exportarPDF()">
                <span class="icon is-small"><i class="mdi mdi-download"></i></span>
                <span> Exportar Gráficos para PDF </span>
            </button>
            <a href="{% url 'questionarios:transportecsvEstatistica' diaaberto.id %}" class="button is-primary" style="background-color: #22911A;" id="obterPdfButton">
                <span class="icon">
                    <i class="fas fa-file-excel"></i>
                </span>
                <span>Exportar Gráficos para CSV</span>
            </a>
            <hr>

        </div>

    </div>

{% endblock content %}